# Семинар 5

## Этапы компиляции

1) Препроцессинг &mdash; подставляется содержимое директив препроцессора (`#include`, `#define`, `#ifndef`, ...). Два вида скобок в `#include`: угловые и кавычки. Первые используются для поиска хедеров в стандартных директориях, вторые &mdash; в локальной по отношению к компилируемому файлу. Команда:

   ```bash
   g++ -E main.cpp > main_preproc.cpp
   ```

2) Компиляция &mdash; исходный код на C++ преобразовывается в ассемблерный (.cpp -> .s). Команда:

   ```bash
   g++ -S file.cpp
   ```

3) Ассемблирование &mdash; ассемблерный код преобразовывается **почти полностью** в объектный файл (.s -> .o). Объектный файл содержит машинные инструкции, которые понятны процессору. Команда:

   ```bash
   g++ -c file.cpp
   ```

4) Линковка &mdash; генерация из объектного файла (или нескольких объектных файлов) исполняемого файла. Тут подключаются динамиче ские библиотеки и подставляются адреса функций (потому что в библиотеках могут быть только объявления функций). Эта стадия нужна, чтобы нам можно было писать код в нескольких файлах и не нужно было каждый раз перекомпилировать большую библиотеку.

Самые частые ошибки линковщика:
- `undefined reference`
- `double definition`

На каждый из этапов выше компилятор вызывает соответствующие программы. Например:
`c1plus` &mdash; для компиляции
`as` &mdash; для ассемблирования
`collect2` &mdash; для линковки
